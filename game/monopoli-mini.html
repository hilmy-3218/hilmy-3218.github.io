<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Monopoli Persegi 20 Petak â€” Player vs AI</title>
<style>
  :root{
    --cell-size:78px;
    --gap:6px;
    --accent:#2563eb;
    --font:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{
    font-family:var(--font);
    background:#f3f4f6;
    color:#0f172a;
    margin:16px;
    display:flex;
    justify-content:center;
    gap:18px;
  }
  .wrap{
    display:flex;
    gap:18px;
    align-items:flex-start;
    max-width:1200px;
    width:100%;
  }
  .board {
    display:grid;
    grid-template-columns: repeat(6, var(--cell-size));
    grid-template-rows: repeat(6, var(--cell-size));
    gap: var(--gap);
    padding: 8px;
    background: linear-gradient(180deg,#ffffff,#f8fafc);
    border-radius:12px;
    box-shadow:0 12px 30px rgba(2,6,23,0.06);
  }
  .cell{
    background:#fff;
    border:1px solid #e6edf8;
    border-radius:8px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    padding:4px;
    font-size:12px;
    position:relative;
    text-align:center;
    overflow:hidden;
  }
  .cell.empty{
    background:transparent;
    border:none;
  }
  .prop-color{height:8px;width:90%;border-radius:3px;margin-bottom:6px}
  .ownerTag{
    position:absolute;top:6px;left:6px;font-size:11px;background:rgba(255,255,255,0.85);padding:2px 6px;border-radius:999px;border:1px solid rgba(0,0,0,0.03)
  }
  .owner-border{position:absolute;bottom:0;left:0;height:6px;border-bottom-left-radius:8px;border-bottom-right-radius:8px;width:100%;opacity:0.95;display:none}
  .token{width:14px;height:14px;border-radius:50%;position:absolute;bottom:6px;box-shadow:0 1px 2px rgba(0,0,0,0.12)}
  .token.player1{background:#ef4444;left:6px}
  .token.player2{background:#10b981;right:6px}
  .sidebar{
    width:360px;
    background:#fff;
    border-radius:12px;
    padding:14px;
    box-shadow:0 8px 22px rgba(2,6,23,0.06);
    flex-shrink:0;
  }
  h2{margin:0 0 8px 0;font-size:18px}
  .status{display:flex;gap:8px;align-items:center;margin-bottom:12px}
  .money{font-weight:700}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
  button{background:var(--accent);color:white;border:none;padding:9px 12px;border-radius:8px;cursor:pointer}
  button.secondary{background:#6b7280}
  .dice{font-size:18px;font-weight:700;padding:6px 10px;border-radius:8px;border:1px dashed #cbd5e1;background:#fff;min-width:44px;text-align:center}
  .props-list{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
  .prop-card{border:1px solid #e6edf8;padding:8px;border-radius:8px;background:#fff;font-size:13px}
  footer{margin-top:12px;font-size:13px;color:#6b7280}
  .small{font-size:12px;color:#6b7280}
  .overlay {
    position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;color:white;font-size:26px;
  }
  .overlay.show{display:flex}
  @media (max-width:980px){
    .wrap{flex-direction:column;align-items:center}
    .sidebar{width:100%}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="board" id="board"></div>

    <div class="sidebar">
      <h2>Monopoli Persegi â€” Player vs AI</h2>
      <div class="status">
        <div><strong>Giliran:</strong> <span id="currentPlayer">Pemain</span></div>
        <div style="margin-left:auto"><strong>Langkah:</strong> <span id="stepInfo">-</span></div>
      </div>

      <div style="display:flex;gap:12px;align-items:center;margin-bottom:8px">
        <div><div>Pemain</div><div class="money">Rp <span id="money1">2100</span></div></div>
        <div style="margin-left:auto"><div>AI</div><div class="money">Rp <span id="money2">2100</span></div></div>
      </div>

      <div class="controls">
        <button id="rollBtn">ðŸŽ² Roll Dadu</button>
        <button id="buyBtn" class="secondary">Beli</button>
        <button id="endBtn" class="secondary">Akhiri Giliran</button>
        <button id="resetBtn" class="secondary">Reset</button>
      </div>

      <div style="margin-top:8px">
        <div>Hasil Dadu: <span class="dice" id="diceResult">-</span></div>
        <div style="margin-top:10px"><strong>Properti Dimiliki</strong>
          <div class="props-list" id="propsList"></div>
        </div>
      </div>

      <footer class="small">
        Papan 6x6 (20 petak keliling). AI tidak wajib beli (probabilitas). Uang &lt; 0 = kalah.
      </footer>
    </div>
  </div>

  <div id="overlay" class="overlay"></div>

<script>
const AI_BUY_PROB = 0.5;
const TOTAL_SPACES = 20;

const boardData = [
  {id:0 , name:'Start', type:'special', desc:'Awal Permainan'},
  {id:1 , name:'Surabaya', type:'property', price:300, rent:150, color:'#f97316'},
  {id:2 , name:'Sidoarjo', type:'property', price:220, rent:140, color:'#fb923c'},
  {id:3 , name:'Pajak Kota', type:'tax', amount:150},
  {id:4 , name:'Probolinggo', type:'property', price:240, rent:120, color:'#06b6d4'},
  {id:5 , name:'Malang', type:'property', price:260, rent:130, color:'#06b6d4'},
  {id:6 , name:'Kediri', type:'property', price:180, rent:90, color:'#fca5a5'},
  {id:7 , name:'Chance', type:'chance'},
  {id:8 , name:'Ngawi', type:'property', price:150, rent:75, color:'#fda4af'},
  {id:9 , name:'Bojonegoro', type:'property', price:170, rent:65, color:'#60a5fa'},
  {id:10, name:'Lamongan', type:'property', price:190, rent:75, color:'#60a5fa'},
  {id:11, name:'Pajak Daerah', type:'tax', amount:200},
  {id:12, name:'Tuban', type:'property', price:140, rent:80, color:'#f97316'},
  {id:13, name:'Blitar', type:'property', price:130, rent:70, color:'#fda4af'},
  {id:14, name:'Tulungagung', type:'property', price:150, rent:75, color:'#fb923c'},
  {id:15, name:'Banyuwangi', type:'property', price:170, rent:75, color:'#06b6d4'},
  {id:16, name:'Pajak Jalan', type:'tax', amount:120},
  {id:17, name:'Solo', type:'property', price:230, rent:115, color:'#8b5cf6'},
  {id:18, name:'Yogyakarta', type:'property', price:320, rent:160, color:'#8b5cf6'},
  {id:19, name:'Chance', type:'chance'}
];

const players = [
  {id:1,name:'Pemain',pos:0,money:2100,tokenClass:'player1',isAI:false},
  {id:2,name:'AI',pos:0,money:2100,tokenClass:'player2',isAI:true}
];

const properties = boardData.map(b => ({...b, owner:null}));

let current = 0;
let rolled = false;
let gameOver = false;

const boardEl = document.getElementById('board');
const currentPlayerEl = document.getElementById('currentPlayer');
const money1El = document.getElementById('money1');
const money2El = document.getElementById('money2');
const diceResultEl = document.getElementById('diceResult');
const propsListEl = document.getElementById('propsList');
const stepInfoEl = document.getElementById('stepInfo');
const overlayEl = document.getElementById('overlay');

function makeGridMapping(){
  const gridMap = new Array(36).fill(null);
  for(let c=0;c<6;c++) gridMap[c] = c;
  for(let r=1;r<=4;r++) gridMap[r*6 + 5] = 5 + r;
  for(let c=5, p=10;c>=0 && p<=15;c--,p++) gridMap[5*6 + c] = p;
  for(let r=4, p=16;r>=1 && p<=19;r--,p++) gridMap[r*6 + 0] = p;
  return gridMap;
}
const GRID_MAP = makeGridMapping();

function buildBoard(){
  boardEl.innerHTML = '';
  for(let idx=0; idx<36; idx++){
    const map = GRID_MAP[idx];
    const c = document.createElement('div');
    c.className = 'cell';
    if(map === null){
      c.classList.add('empty');
    } else {
      const b = properties[map];
      if(b.type === 'property'){
        const colorBar = document.createElement('div');
        colorBar.className = 'prop-color';
        colorBar.style.background = b.color||'#ddd';
        c.appendChild(colorBar);
      }
      const name = document.createElement('div');
      name.style.fontWeight = '600';
      name.style.fontSize = '12px';
      name.textContent = b.name;
      c.appendChild(name);

      const sub = document.createElement('div');
      sub.style.fontSize = '11px';
      sub.style.marginTop = '4px';
      if(b.type === 'property') sub.textContent = `Rp ${b.price} Â· Sewa ${b.rent}`;
      else if(b.type === 'tax') sub.textContent = `Bayar Rp ${b.amount}`;
      else if(b.type === 'chance') sub.textContent = `Chance`;
      else sub.textContent = b.desc||'';
      c.appendChild(sub);

      const ownerTag = document.createElement('div');
      ownerTag.className = 'ownerTag';
      ownerTag.textContent = '';
      c.appendChild(ownerTag);

      const ownerBorder = document.createElement('div');
      ownerBorder.className = 'owner-border';
      ownerBorder.style.display = 'none';
      c.appendChild(ownerBorder);

      c.dataset.space = map;
      c.id = 'space-' + map;
    }
    boardEl.appendChild(c);
  }
  renderTokens();
  refreshOwners();
}

function renderTokens(){
  document.querySelectorAll('.token').forEach(t=>t.remove());
  players.forEach(p=>{
    const space = p.pos;
    const el = document.getElementById('space-' + space);
    if(el){
      const t = document.createElement('div');
      t.className = 'token ' + p.tokenClass;
      t.title = p.name;
      el.appendChild(t);
    }
  });
}

function refreshOwners(){
  document.querySelectorAll('.cell').forEach(c=>{
    const space = c.dataset.space;
    if(space === undefined) return;
    const b = properties[space];
    const tag = c.querySelector('.ownerTag');
    const border = c.querySelector('.owner-border');
    if(b.owner){
      tag.textContent = b.owner.name;
      border.style.display = 'block';
      border.style.background = b.owner.isAI ? '#10b981' : '#ef4444';
    } else {
      tag.textContent = '';
      border.style.display = 'none';
    }
  });
}

function updateUI(){
  currentPlayerEl.textContent = players[current].name;
  money1El.textContent = players[0].money;
  money2El.textContent = players[1].money;
  propsListEl.innerHTML = '';
  properties.forEach(p=>{
    if(p.type === 'property' && p.owner){
      const card = document.createElement('div');
      card.className = 'prop-card';
      card.innerHTML = `<div style="font-weight:700">${p.name}</div><div>Owner: ${p.owner.name}</div><div>Harga: Rp ${p.price}</div>`;
      propsListEl.appendChild(card);
    }
  });
  renderTokens();
  refreshOwners();
}

document.getElementById('rollBtn').addEventListener('click', ()=>{
  if(gameOver) return;
  if(players[current].isAI) return;
  if(rolled) return;
  rollAndMove();
});
document.getElementById('buyBtn').addEventListener('click', ()=>{
  if(gameOver) return;
  buyProperty(players[current]);
});
document.getElementById('endBtn').addEventListener('click', ()=>{
  if(gameOver) return;
  endTurn();
});
document.getElementById('resetBtn').addEventListener('click', ()=>{
  resetGame();
});

function rollAndMove(){
  const r = Math.floor(Math.random()*6)+1;
  diceResultEl.textContent = r;
  rolled = true;
  stepInfoEl.textContent = `Melangkah ${r} petak`;
  moveCurrentBy(r);
}

function moveCurrentBy(n){
  const pl = players[current];
  pl.pos = (pl.pos + n) % properties.length;
  handleLanding(pl, properties[pl.pos]);
  updateUI();
  checkGameOver();
}

function handleLanding(player, cell){
  if(cell.type === 'property'){
    if(cell.owner && cell.owner !== player){
      const rent = cell.rent;
      player.money -= rent;
      cell.owner.money += rent;
    } else if(!cell.owner){
      if(player.isAI){
        const willBuy = (Math.random() < AI_BUY_PROB);
        if(willBuy && player.money >= cell.price){
          buyProperty(player, true);
        }
      }
    }
  } else if(cell.type === 'tax'){
    player.money -= cell.amount;
  } else if(cell.type === 'chance'){
    const outcomes = [100, -100, 150, -50, 200, -150, 0];
    const x = outcomes[Math.floor(Math.random()*outcomes.length)];
    player.money += x;
  }
}

function buyProperty(player, isAI=false){
  const cell = properties[player.pos];
  if(cell.type !== 'property') return;
  if(cell.owner) return;
  if(player.money < cell.price) return;
  player.money -= cell.price;
  cell.owner = player;
  updateUI();
  checkGameOver();
}

function endTurn(){
  if(!rolled) return;
  rolled = false;
  diceResultEl.textContent = '-';
  stepInfoEl.textContent = '-';
  current = (current + 1) % players.length;
  updateUI();
  if(players[current].isAI && !gameOver){
    setTimeout(()=>{
      rollAndMove();
      setTimeout(()=>{ endTurn(); }, 900);
    }, 700);
  }
}

function checkGameOver(){
  if(gameOver) return;
  if(players[0].money < 0){
    gameOver = true;
    announceWinner(players[1]);
  } else if(players[1].money < 0){
    gameOver = true;
    announceWinner(players[0]);
  }
}

function announceWinner(winner){
  overlayEl.textContent = `${winner.name} Menang!`;
  overlayEl.classList.add('show');
  document.getElementById('rollBtn').disabled = true;
  document.getElementById('buyBtn').disabled = true;
  document.getElementById('endBtn').disabled = true;
}

function resetGame(){
  properties.forEach(p => { p.owner = null; });
  players.forEach(p => { p.pos = 0; p.money = 2100; });
  current = 0;
  rolled = false;
  gameOver = false;
  overlayEl.classList.remove('show');
  overlayEl.textContent = '';
  document.getElementById('rollBtn').disabled = false;
  document.getElementById('buyBtn').disabled = false;
  document.getElementById('endBtn').disabled = false;
  diceResultEl.textContent = '-';
  stepInfoEl.textContent = '-';
  buildBoard();
  updateUI();
}

buildBoard();
updateUI();
</script>
</body
